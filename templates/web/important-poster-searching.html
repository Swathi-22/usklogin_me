{% load humanize %}

<!-- important poster -->
<div class="row">
  {% for posters in important_poster %}


  <div class="col-lg-3 col-md-4 col-sm-6 col-6">
    <div class="card card-body w-100">
      <img src="{{posters.image.url}}" data-id="{{posters.id | apnumber }}" alt="Image">

      <div class="text-center mt-3">
        <button class="btn-sm mx-auto btn btn-primary" target="_blank" rel="noopener noreferrer"
          data-source="{{posters.id | apnumber }}">Click to Download</button>
      </div>

      <span>{{posters.title}}</span>
    </div>
  </div>

  {% endfor %}
</div>



<!-- Modal -->
<div class="modal" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header pb-0">
        <h5 class="modal-title" id="exampleModalLongTitle">Download Poster</h5>
      </div>
      <div class="modal-body">
      </div>
      <div class="modal-footer" id="modalFooter">

      </div>
    </div>
  </div>
</div>

<img src="https://cdn.pixabay.com/photo/2022/01/17/06/52/nature-6944000_960_720.jpg" alt="" class="d-none"
  id="footerImage" />


<script>
  function generateImage(elm) {
    var canvas = document.createElement('canvas');
    canvas.width = Width;
    canvas.height = headerImageHeight + footerImageHeight + HeightAdjustment;
    var ctx = canvas.getContext('2d');
    var modalBody = document.querySelector('.modal-body');
    modalBody.appendChild(canvas);
    var footerImage = document.getElementById('footerImage');
    var source = elm.getAttribute('data-source');
    var dataImage = document.querySelector(`img[data-id="${source}"]`)
    ctx.drawImage(dataImage, 0, 0, Width, headerImageHeight);
    ctx.drawImage(footerImage, 0, headerImageHeight + HeightAdjustment, Width, footerImageHeight);

    var modalFooter = document.querySelector('.modal-footer');
    modalFooter.innerHTML = '';

    image = canvas.toDataURL("image/png", 1.0).replace("image/png", "image/octet-stream");
    var link = document.createElement('a');
    link.setAttribute('href', image);
    link.setAttribute('download', 'image.png');
    link.setAttribute('class', 'btn btn-primary d-block');
    link.innerHTML = 'Download';
    modalFooter.appendChild(link);
  }

  var buttons = document.querySelectorAll('.generate');
  var Width = 1080; //> same width to both images
  var headerImageHeight = 858;
  var footerImageHeight = 222;
  var HeightAdjustment = 0;

  buttons.forEach(function (button) {
    button.addEventListener('click', function () {
      $('.modal-body').empty();
      $('#exampleModalCenter').modal('show');
      generateImage(this);
    });
  });


</script>
